# ================================================
# Cygnus agent configuration
# Hist√≥rico + LastData + PostgreSQL
# ================================================

cygnus-ngsi.sources = http-source-postgresql-HL  http-source-postgresql-H http-source-postgresql-L
cygnus-ngsi.sinks = postgresql-sink-HL postgresql-sink-H postgresql-sink-L 
cygnus-ngsi.channels = postgresql-channel-HL postgresql-channel-H postgresql-channel-L


#HISTORIC Y LASTDATA
# Postgresql http-source
cygnus-ngsi.sources.http-source-postgresql-HL.type = org.apache.flume.source.http.HTTPSource
cygnus-ngsi.sources.http-source-postgresql-HL.channels = postgresql-channel
cygnus-ngsi.sources.http-source-postgresql-HL.port = 5055
cygnus-ngsi.sources.http-source-postgresql-HL.handler = com.telefonica.iot.cygnus.handlers.NGSIRestHandler
cygnus-ngsi.sources.http-source-postgresql-HL.handler.notification_target = /notify
cygnus-ngsi.sources.http-source-postgresql-HL.handler.default_service = default
cygnus-ngsi.sources.http-source-postgresql-HL.handler.default_service_path = /
cygnus-ngsi.sources.http-source-postgresql-HL.interceptors = ts nmi
cygnus-ngsi.sources.http-source-postgresql-HL.interceptors.ts.type = timestamp
cygnus-ngsi.sources.http-source-postgresql-HL.interceptors.nmi.type = com.telefonica.iot.cygnus.interceptors.NGSINameMappingsInterceptor$Builder
cygnus-ngsi.sources.http-source-postgresql-HL.interceptors.nmi.name_mappings_conf_file = /opt/apache-flume/conf/name_mappings.conf

# NGSIPostgreSQLSink configuration
cygnus-ngsi.sinks.postgresql-sink-HL.type = com.telefonica.iot.cygnus.sinks.NGSIPostgreSQLSink
cygnus-ngsi.sinks.postgresql-sink-HL.channel = postgresql-channel
#cygnus-ngsi.sinks.postgresql-sink.enable_encoding = false
#cygnus-ngsi.sinks.postgresql-sink.enable_name_mappings = false
#cygnus-ngsi.sinks.postgresql-sink.enable_lowercase = false
cygnus-ngsi.sinks.postgresql-sink-HL.data_model = dm-by-entity-type
cygnus-ngsi.sinks.postgresql-sink-HL.postgresql_host = timescale
cygnus-ngsi.sinks.postgresql-sink-HL.postgresql_port = 5432
cygnus-ngsi.sinks.postgresql-sink-HL.postgresql_username = admin
cygnus-ngsi.sinks.postgresql-sink-HL.postgresql_password = admin
cygnus-ngsi.sinks.postgresql-sink-HL.postgresql_database = geopamplona
cygnus-ngsi.sinks.postgresql-sink-HL.attr_persistence = column
cygnus-ngsi.sinks.postgresql-sink-HL.enable_last_instance = true
cygnus-ngsi.sinks.postgresql-sink-HL.attr_metadata_store = false
#LASTDATA CONFIGURATION
cygnus-ngsi.sinks.postgresql-sink-HL.last_data_table_suffix = _lastdata
cygnus-ngsi.sinks.postgresql-sink-HL.last_data_unique_key = entityid
cygnus-ngsi.sinks.postgresql-sink-HL.last_data_mode = both
cygnus-ngsi.sinks.postgresql-sink-HL.enable_metadata = false


# Channels
cygnus-ngsi.channels.postgresql-channel-HL.type = com.telefonica.iot.cygnus.channels.CygnusMemoryChannel
cygnus-ngsi.channels.postgresql-channel-HL.capacity = 100000
cygnus-ngsi.channels.postgresql-channel-HL.transactionCapacity = 10000


#ONLY HISTORIC----------------------------------------------------------------------------------------------------------------------------------------
# Postgresql http-source
cygnus-ngsi.sources.http-source-postgresql-H.type = org.apache.flume.source.http.HTTPSource
cygnus-ngsi.sources.http-source-postgresql-H.channels = postgresql-channel
cygnus-ngsi.sources.http-source-postgresql-H.port = 5056
cygnus-ngsi.sources.http-source-postgresql-H.handler = com.telefonica.iot.cygnus.handlers.NGSIRestHandler
cygnus-ngsi.sources.http-source-postgresql-H.handler.notification_target = /notify
cygnus-ngsi.sources.http-source-postgresql-H.handler.default_service = default
cygnus-ngsi.sources.http-source-postgresql-H.handler.default_service_path = /
cygnus-ngsi.sources.http-source-postgresql-H.interceptors = ts nmi
cygnus-ngsi.sources.http-source-postgresql-H.interceptors.ts.type = timestamp
cygnus-ngsi.sources.http-source-postgresql-H.interceptors.nmi.type = com.telefonica.iot.cygnus.interceptors.NGSINameMappingsInterceptor$Builder
cygnus-ngsi.sources.http-source-postgresql-H.interceptors.nmi.name_mappings_conf_file = /opt/apache-flume/conf/name_mappings.conf

# NGSIPostgreSQLSink configuration
cygnus-ngsi.sinks.postgresql-sink-H.type = com.telefonica.iot.cygnus.sinks.NGSIPostgreSQLSink
cygnus-ngsi.sinks.postgresql-sink-H.channel = postgresql-channel
#cygnus-ngsi.sinks.postgresql-sink.enable_encoding = false
#cygnus-ngsi.sinks.postgresql-sink.enable_name_mappings = false
#cygnus-ngsi.sinks.postgresql-sink.enable_lowercase = false
cygnus-ngsi.sinks.postgresql-sink-H.data_model = dm-by-entity-type
cygnus-ngsi.sinks.postgresql-sink-H.postgresql_host = timescale
cygnus-ngsi.sinks.postgresql-sink-H.postgresql_port = 5432
cygnus-ngsi.sinks.postgresql-sink-H.postgresql_username = admin
cygnus-ngsi.sinks.postgresql-sink-H.postgresql_password = admin
cygnus-ngsi.sinks.postgresql-sink-H.postgresql_database = geopamplona
cygnus-ngsi.sinks.postgresql-sink-H.attr_persistence = column
cygnus-ngsi.sinks.postgresql-sink-H.enable_last_instance = true
cygnus-ngsi.sinks.postgresql-sink-H.attr_metadata_store = false


# Channels
cygnus-ngsi.channels.postgresql-channel-H.type = com.telefonica.iot.cygnus.channels.CygnusMemoryChannel
cygnus-ngsi.channels.postgresql-channel-H.capacity = 100000
cygnus-ngsi.channels.postgresql-channel-H.transactionCapacity = 10000



#ONLY LASTDATA
# Postgresql http-source
cygnus-ngsi.sources.http-source-postgresql-L.type = org.apache.flume.source.http.HTTPSource
cygnus-ngsi.sources.http-source-postgresql-L.channels = postgresql-channel
cygnus-ngsi.sources.http-source-postgresql-L.port = 5057
cygnus-ngsi.sources.http-source-postgresql-L.handler = com.telefonica.iot.cygnus.handlers.NGSIRestHandler
cygnus-ngsi.sources.http-source-postgresql-L.handler.notification_target = /notify
cygnus-ngsi.sources.http-source-postgresql-L.handler.default_service = default
cygnus-ngsi.sources.http-source-postgresql-L.handler.default_service_path = /
cygnus-ngsi.sources.http-source-postgresql-L.interceptors = ts nmi
cygnus-ngsi.sources.http-source-postgresql-L.interceptors.ts.type = timestamp
cygnus-ngsi.sources.http-source-postgresql-L.interceptors.nmi.type = com.telefonica.iot.cygnus.interceptors.NGSINameMappingsInterceptor$Builder
cygnus-ngsi.sources.http-source-postgresql-L.interceptors.nmi.name_mappings_conf_file = /opt/apache-flume/conf/name_mappings.conf

# NGSIPostgreSQLSink configuration
cygnus-ngsi.sinks.postgresql-sink-L.type = com.telefonica.iot.cygnus.sinks.NGSIPostgreSQLSink
cygnus-ngsi.sinks.postgresql-sink-L.channel = postgresql-channel
#cygnus-ngsi.sinks.postgresql-sink.enable_encoding = false
#cygnus-ngsi.sinks.postgresql-sink.enable_name_mappings = false
#cygnus-ngsi.sinks.postgresql-sink.enable_lowercase = false
cygnus-ngsi.sinks.postgresql-sink-L.data_model = dm-by-entity-type
cygnus-ngsi.sinks.postgresql-sink-L.postgresql_host = timescale
cygnus-ngsi.sinks.postgresql-sink-L.postgresql_port = 5432
cygnus-ngsi.sinks.postgresql-sink-L.postgresql_username = admin
cygnus-ngsi.sinks.postgresql-sink-L.postgresql_password = admin
cygnus-ngsi.sinks.postgresql-sink-L.postgresql_database = geopamplona
cygnus-ngsi.sinks.postgresql-sink-L.attr_persistence = column
cygnus-ngsi.sinks.postgresql-sink-L.enable_last_instance = true
cygnus-ngsi.sinks.postgresql-sink-L.attr_metadata_store = false
#LASTDATA CONFIGURATION
cygnus-ngsi.sinks.postgresql-sink-L.last_data_table_suffix = _lastdata
cygnus-ngsi.sinks.postgresql-sink-L.last_data_unique_key = entityid
cygnus-ngsi.sinks.postgresql-sink-L.last_data_mode = upsert
cygnus-ngsi.sinks.postgresql-sink-L.enable_metadata = false

#cygnus-ngsi.sinks.postgresql-sink-L.attr_native_types = false
#cygnus-ngsi.sinks.postgresql-sink-L.batch_size = 1
#cygnus-ngsi.sinks.postgresql-sink-L.batch_timeout = 30
#cygnus-ngsi.sinks.postgresql-sink-L.batch_ttl = 10
#cygnus-ngsi.sinks.postgresql-sink-L.backend.enable_cache = false
#cygnus-ngsi.sinks.postgresql-sink-L.postgresql_options =

# Channels
cygnus-ngsi.channels.postgresql-channel-L.type = com.telefonica.iot.cygnus.channels.CygnusMemoryChannel
cygnus-ngsi.channels.postgresql-channel-L.capacity = 100000
cygnus-ngsi.channels.postgresql-channel-L.transactionCapacity = 10000
